[package]
name = "svc-passport"
version = "0.1.0"
edition = "2021"
license = "MIT OR Apache-2.0"
publish = false

[lib]
name = "svc_passport"
path = "src/lib.rs"

[[bin]]
name = "svc-passport"
path = "src/main.rs"

[features]
# Enable dev-kms by default so the crate runs out-of-the-box.
default = ["with-metrics", "dev-kms"]
dalek-batch = []
parallel-batch = []
with-metrics = []
bus-rpc = []
dev-kms = ["dep:ed25519-dalek", "dep:rand_core"]

[dependencies]
# RON workspace crates
ron-kernel = { path = "../ron-kernel" }
ron-policy = { path = "../ron-policy" }

# Async/HTTP stack (match workspace pins explicitly)
tokio = { workspace = true, features = ["macros","rt-multi-thread","signal","time","io-util","sync","net","fs"] }
axum  = { workspace = true, default-features = false, features = ["tokio","http1","http2","json"] }
# IMPORTANT: explicitly mirror workspace tower settings to avoid 0.4/0.5 splits
tower = { workspace = true, default-features = false, features = ["util", "limit"] }
tower-http = { workspace = true, features = ["trace"] }
http  = { workspace = true }
# hyper/hyper-util are fine to keep local
hyper = { version = "1", features = ["http1","http2","server"] }
hyper-util = "0.1"

# Metrics/obs
prometheus = { workspace = true }
tracing = { workspace = true }
tracing-subscriber = { workspace = true, features = ["fmt","env-filter"] }

# Serde / JSON / config / time
serde      = { workspace = true, features = ["derive"] }
serde_json = { workspace = true }
toml       = { workspace = true }
time       = { version = "0.3", features = ["formatting","parsing","macros"] }
uuid       = { version = "1", features = ["v4"] }
base64     = "0.22"

# Concurrency / utils
parking_lot = { workspace = true }
once_cell   = { workspace = true }

# Errors
thiserror = { workspace = true }   # aligns to workspace (v1) to avoid dupes
anyhow    = { workspace = true }

# Async trait for dyn-safe async methods
async-trait = "0.1"

# Zeroization
zeroize = "1"

# Dev KMS (optional; enabled by dev-kms feature)
ed25519-dalek = { version = "2", features = ["rand_core","serde"], optional = true }
rand_core     = { version = "0.6", features = ["getrandom"], optional = true }

[dev-dependencies]
reqwest = { workspace = true, features = ["rustls-tls-native-roots","json"] }
tokio   = { workspace = true, features = ["macros","rt-multi-thread","time"] }
